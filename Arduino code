#include <Keypad.h>

int latchPin = 11;
int clockPin = 9;
int dataPin = 12;
int pinCLK = 2;
int pinDT = 3;

int CLK;
int DT;
int oldCLK;
int oldDT;

byte leds = 0b1;

void updateShiftRegister()
{
   digitalWrite(latchPin, LOW);
   shiftOut(dataPin, clockPin, LSBFIRST, leds);
   digitalWrite(latchPin, HIGH);
}

void setup() 
{
  pinMode(latchPin, OUTPUT);
  pinMode(dataPin, OUTPUT);  
  pinMode(clockPin, OUTPUT);
  pinMode(pinCLK, INPUT);
  pinMode(pinDT, INPUT);

  delay(200);

  updateShiftRegister();

  oldCLK = digitalRead(pinCLK);
  oldDT = digitalRead(pinDT);

  attachInterrupt(digitalPinToInterrupt(pinCLK), changeCLK, CHANGE);
}

void loop() 
{
}

void changeCLK() {
  CLK = digitalRead(pinCLK);
  DT = digitalRead(pinDT);

  if ((CLK == HIGH) && (DT == LOW) && (oldCLK == LOW) && (oldDT == HIGH)) {
    leds >>= 1;
    if (leds == 0) leds = 0b10000000;
    updateShiftRegister();
  }
  if ((CLK == HIGH) && (DT == HIGH) && (oldCLK == LOW) && (oldDT == LOW)) {
    leds <<= 1;
    if (leds == 0) leds = 0b1;
    updateShiftRegister();
  }
  oldCLK = CLK;
  oldDT = DT;
}
